<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>نظام إدارة البيانات الآمن</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      direction: rtl;
      background-color: #f0f2f5;
      padding: 20px;
    }

    .container {
      max-width: 1100px;
      margin: auto;
      background: #fff;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 0 12px rgba(0,0,0,0.1);
    }

    h2 {
      text-align: center;
    }

    input, button {
      padding: 8px;
      margin: 5px;
      border-radius: 6px;
      font-size: 16px;
    }

    input[type="text"], input[type="password"], input[type="date"], input[type="number"] {
      border: 1px solid #ccc;
      width: 100%;
      box-sizing: border-box;
    }

    button {
      background-color: #4CAF50;
      color: white;
      border: none;
    }

    button:hover {
      background-color: #45a049;
      cursor: pointer;
    }

    table {
      width: 100%;
      margin-top: 15px;
      border-collapse: collapse;
    }

    th, td {
      border: 1px solid #ddd;
      padding: 10px;
      text-align: center;
    }

    th {
      background-color: #eee;
    }

    .editable[contenteditable="true"] {
      background-color: #ffffcc;
    }

    .actions {
      margin: 10px 0;
    }

    .hidden-cell {
      color: #ccc;
      font-style: italic;
    }

    .pass-cell {
      display: flex;
      gap: 5px;
      justify-content: center;
      align-items: center;
    }

    .pass-cell input {
      width: 100px;
    }
  </style>
</head>
<body>
<div class="container">
  <h2>نظام إدارة البيانات الآمن</h2>

  <div class="actions">
    <input type="text" id="search" placeholder="ابحث بالاسم أو الكود">
    <button onclick="login()">تسجيل كمدير</button>
    <button onclick="addRow()" id="addRowBtn" disabled>إضافة صف</button>
    <button onclick="saveData()" id="saveBtn" disabled>حفظ التعديلات</button>
  </div>

  <table id="dataTable">
    <thead>
    <tr>
      <th>الكود</th>
      <th>الاسم</th>
      <th>التاريخ</th>
      <th>الرصيد</th>
      <th>جروث</th>
      <th>كلمة المرور</th>
    </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<script>
  let isAdmin = false;

  const defaultData = [
    { code: 'A001', name: 'مصطفى', date: '2025-05-01', balance: 1000, growth: '+5%', password: '111' },
    { code: 'B002', name: 'علي', date: '2025-05-03', balance: 750, growth: '-3%', password: '222' }
  ];

  function getStoredData() {
    return JSON.parse(localStorage.getItem('data')) || defaultData;
  }

  function saveToStorage(data) {
    localStorage.setItem('data', JSON.stringify(data));
  }

  let data = getStoredData();

  function renderTable(filteredData) {
    const tbody = document.querySelector('#dataTable tbody');
    tbody.innerHTML = '';

    filteredData.forEach((row, index) => {
      const tr = document.createElement('tr');
      const showSensitive = row._unlocked || isAdmin;

      tr.innerHTML = `
        <td contenteditable="${isAdmin}" class="editable">${row.code}</td>
        <td contenteditable="${isAdmin}" class="editable">${row.name}</td>
        <td contenteditable="${isAdmin}" class="editable">${row.date}</td>
        <td contenteditable="${isAdmin}" class="editable">
          ${showSensitive ? row.balance : `<span class="hidden-cell">****</span>`}
        </td>
        <td contenteditable="${isAdmin}" class="editable">
          ${showSensitive ? row.growth : `<span class="hidden-cell">****</span>`}
        </td>
        <td class="pass-cell">
          <input type="password" id="pass-${index}" placeholder="كلمة المرور">
          <button onclick="unlock(${index})">موافق</button>
        </td>
      `;
      tbody.appendChild(tr);
    });
  }

  function unlock(index) {
    const pass = document.getElementById(`pass-${index}`).value;
    if (pass === data[index].password) {
      data[index]._unlocked = true;
      renderTable(data);
    } else {
      alert("كلمة المرور غير صحيحة");
    }
  }

  function login() {
    const username = prompt("ادخل اسم المستخدم:");
    const password = prompt("ادخل كلمة المرور:");

    if (username === 'admin' && password === '1234') {
      isAdmin = true;
      document.getElementById('addRowBtn').disabled = false;
      document.getElementById('saveBtn').disabled = false;
      renderTable(data);
    } else {
      alert("بيانات الدخول غير صحيحة");
    }
  }

  function addRow() {
    data.push({ code: '', name: '', date: '', balance: '', growth: '', password: '', _unlocked: true });
    renderTable(data);
  }

  function saveData() {
    const rows = document.querySelectorAll('#dataTable tbody tr');
    data = [];

    rows.forEach((tr, index) => {
      const cells = tr.querySelectorAll('td');
      const code = cells[0].innerText.trim();
      const name = cells[1].innerText.trim();
      const date = cells[2].innerText.trim();
      const balance = cells[3].innerText.includes('****') ? '' : cells[3].innerText.trim();
      const growth = cells[4].innerText.includes('****') ? '' : cells[4].innerText.trim();
      const passwordInput = tr.querySelector(`#pass-${index}`);
      const password = passwordInput ? passwordInput.value : '';

      data.push({
        code, name, date, balance, growth,
        password: password || (data[index]?.password || ''),
        _unlocked: isAdmin || data[index]?._unlocked
      });
    });

    saveToStorage(data);
    alert("تم حفظ البيانات");
  }

  document.getElementById('search').addEventListener('input', function () {
    const q = this.value.toLowerCase();
    const filtered = data.filter(row =>
      row.code.toLowerCase().includes(q) || row.name.toLowerCase().includes(q)
    );
    renderTable(filtered);
  });

  // أول تحميل
  renderTable(data);
</script>
</body>
</html>